## 7. SQL 응용



##### 1. 데이터베이스 기본



**트랜잭션** - 인가받지 않은 사용자로부터 데이터 보장하기 위해 DBMS가 가져야 하는 특성

- 특성
  - 원자성(Atomicity) - 연산 전체가 모두 정상적으로 되거나 모두 취소 / 회복성 보장 / Commit, Rollback
  - 일관성(Consistency) - 고정 요소는 트랜잭션 수행 전과 후의 상태가 같아야 / 무결성 제약조건 / 동시성 제어
  - 격리성(고립성)(Isolation) - 동시 실행되는 트랜잭션들이 서로 영향 미치지 않아야
  - 영속성(Durability) - 성공 완료된 트랜잭션 결과는 영속적으로 저장되어야 
- 상태변화
  - 활동 상태
  - 부분 완료 상태
  - 완료 상태
  - 실패 상태
  - 철회 상태
- 제어
  - 제어언어는 TCL
  - COMMIT
  - ROLLBACK
  - CHECKPOINT - 저장 시기 설정
- 병행 제어(일관성 주요 기법)
  - 병행 제어 - 다수 사용자 환경에서 여러 트랜잭션 수행할 때 일관성 유지 위해 상호 작용 제어
  - 종류
    - 로킹
    - 낙관적 검증
    - 타임 스탬프 순서
    - 다중버전 동시성 제어
- 데이터베이스 고립화 수준(격리성 주요 기법)
  - 다른 트랜잭션이 현재 데이터에 대한 무결성 해치지 않기 위해 잠금 설정
- 회복 기법(영속성 주요 기법)
  - 장애로 인한 손상된 DB를 손사오디기 이전의 정상적 상태로 복구
  - 종류
    - 로그 기반 회북 기법 - 지연 갱신 회복 기법 / 즉각 갱신 회복 기법
    - 체크 포인트 회복 기법 - 검사점 이후에 처리된 트랜잭션에 대해서만 장애 발생 이전으로 복원
    - 그림자 페이징 회복 기법 - 복제본 생성



**DDL(데이터 정의어)** - 데이터 담는 그릇을 정의

- 대상
  - 도메인 - 원자값들의 집합
  - 스키마 - DB의 구조, 제약조건등의 정보를 담는 기본 구조
    - 외부 스키마 - 사용자가 개발자 관점에서 필요로, 사용자 뷰 나타냄, 서브 스키마로 불림
    - 개념 스키마(Conceptual) - 전체적 논리 구조, 전체적 뷰 나타냄, 무결성 보안에 대해 정의
    - 내부 스키마 - 물리적 저장장치 관점에서 봄, 레코드 형식 정의, 내부 레코드의 물리적 순서 
  - 테이블 
    - 행 - Row / Tuple / Cardinality
    - 열 - Column / Attribute / Degree
  - 뷰
    - 목적 - 단순 질의어 사용 가능 / 데이터 일부만을 제공할 수 있다는 장단점
  - 인덱스
    - 기본키 (PK) 컬럼은 자동으로 인덱스 생성
- 명령어
  - CREATE
  - ALTER
  - DROP - 오브젝트 삭제
  - TRUNCATE - 오브젝트 내용 삭제

- 테이블에서의 DDL
  - DROP TABLE - 아래 옵션들의 외래키가 걸려있을 때 해당 
    - CASCADE - 참조하는 테이블까지 연쇄적으로 제거
    - RESTRICT - 참조 중이면 제거하지 않음
- 뷰에서의 DDL
  - 뷰는 ALTER할 수 없음 > DROP 후 CREATE 하거나, CREATE OR REPLACE VIEW 명령을 해야
  - CREATE VIEW
    - UNION
    - ORDER BY
  - CREATE OR REPLACE VIEW
- 인덱스에서의 DDL
  - CREATE INDEX
    - UNIQUE는 생략 가능하고
    - 중복값 허용 안함
    - 복수 컬럼 인덱스로 걸 수 ㅇ



**DML(데이터 조작어)**

- 유형

  - SELECT

  - INSERT

    - INSERT INTO 테이블(컬럼)

      VALUES (컬럼값)

  - UPDATE

    - UPDATE 테이블

      SET 속셩 명 = 값

      WHERE 조건

  - DELETE

    - DELETE FROM 테이블

      WHERE  조건

- 명령어

  - SELECT
    - DISTINCT - 중복된 튜플 있으면 그 중 첫 번째 한 개만 선택
    - JOIN
      - 내부 조인
      - 외부 조인
      - 교차 조인
      - 셀프 조인
    - 서브쿼리 - SQL 문 안에 포함된 또 다른 SQL ( 주종관계)
    - 집합 연산자
      - UNION - 중복 행 제거 된 쿼리 결과 반환
      - UNION ALL - 중복 행 제거 안된 쿼리 결과 반환
      - INTERSECT
      - MINUS
  - FROM
  - WHERE
    - BETWEEN A AND B
    - A IN (B,C,D..)
    - LIKE (컬럼이 패턴에 포함된 경우의 데이터 조회)
  - GROUP BY
  - HAVING - GROUP BY 후 그룹에 대한 조건 지정
  - ORDER BY



**DCL(데이터 제어어)** - 데이터 보안, 무결성 유지, 병행 제어 회복을 위해 관리자가 사용

- 유형
  - GRANT - 사용 권한 부여
    - GRANT UPDATE ON 테이블 TO 사용자
  - REVOKE - 사용 권한 취소
    - REVOKE UPDATE ON  테이블 TO 사용자
