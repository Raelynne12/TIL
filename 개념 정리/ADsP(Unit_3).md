# 3 - 데이터 분석



## (1) R기초



**특징**

1. 오픈 소스
2. 데이터 핸들링 우수(다양한 데이터 읽어오는 기능)
3. 인터프리터 언어
4. 동적 그래프 지원
5. 다양한 형태 데이터 구조 지원 > 분석 대응력 좋음
6. 메모리(RAM)에서 작동하기 때문에 속도 빠르다



**데이터 구조**

1. Vector

   - c(), : , seq(), rep()

   ```R
   #1. c함수
   c(1,2,3) + 2
   #[1] 3 4 5
   c(1,2,3) + c(4,5,6,7)
   #[1] 5 7 9 8
   
   #2. :
   1:7
   #[1] 1 2 3 4 5 6 7
   
   #3. seq() : 등차수열
   seq(1,4) #시작, 끝 (+ 간격)
   #[1] 1 2 3 4
   
   #4. rep()
   rep(c(1,2,3), times = 2, each = 2)
   #[1] 1 1 2 2 3 3 1 1 2 2 3 3
   
   #5. sequence()
   sequence(1:5)
   #[1] 1 1 2 1 2 3 1 2 3 4 1 2 3 4 5
   ```

2. Matrix

   - 한 가지 유형의 스칼라만 사용 가능

   ```R
   m <- matrix(c(1,2,3,4,5,6), ncol = 2)
   m
   #	[,1][,2]
   #[1,] 1   4
   #[2,] 2   5
   #[3,] 3   6
   
   #rbind > 행 추가
   #cbind > 열 추가
   ```

3. Array

   - 다차원 데이터

   ```R
   array(1:6, dim = c(3,2)) #3*4
   #	[,1][,2]
   #[1,] 1   4
   #[2,] 2   5
   #[3,] 3   6
   ```

   

4. Data frame

   ```R
   a <- c(100,200,300)
   d <- data.frame(income = a1, car = b1, marriage = 1)
   d
   # income car marriage
   #1	100	  a		FALSE
   #2	200	  b		FALSE
   #3	300   c		FALSE
   ```

5. List

   - 서로 다른 데이터 유형 담기 가능

   ```R
   x <- list(name = 'kim', height = 170)
   x
   #$name
   #[1] 'kim'
   #$height
   #[1] 170
   ```

\+ 행렬의 역행렬 : solve()



**기초통계 정리**

![image-20220223214044241](ADsP(Unit_3).assets/image-20220223214044241.png)



**데이터 핸들링**

```R
#1) paste : 입력받은 문자열들을 하나로 붙여줌
paste(number, alphabet)
#[1] '1 a' '2 b'...

#2) substr : n번째 글자부터 m번째 글자만 추출

#3) as.Date('02/13/2018', format = '%m/%d/%Y')
```



**r그래픽**

- 산점도 함수 : plot()
- 산점도 행렬 : pairs() >> 각각의 산점도 한 눈에 살펴보기
- 히스토그램 : hist()
- 박스플롯
- 모자이크플롯



---



## (2) 데이터 마트

> 데이터의 한 부분, 특정 사용자가 관심을 갖는 데이터들을 담은 비교적 작은 규모의 데이터 웨어하우스



```R
#1) melt()
# + na.rm = False : NA인 행을 결과에 포함 안시킨다

#2) cast(): melt()된 데이터를 다시 여러 컬럼으로 변환

#3) sqldf('select*from iris') : sql문 사용할 줄 아는 사용자가 쉽게 데이터 접근할 수 있

#4) plyr  : split, apply, combine

#5) data.table
```



---



## (3) 결측값 처리와 이상값 검색



1. 결측값 대치법

   1. 단순 대치법

      - 완전 분석법 : NA값 다 제외

      - 평균 대치법 : 평균값으로 대치

      - 단순 확률 대치법 :

        | cold-deck         | 이전 자료 사용                                               |
        | ----------------- | ------------------------------------------------------------ |
        | hot-deck          | 대체군 내에서 하나 랜덤 설정                                 |
        | regression        | 보조 변수 > 회귀 예측치 대체                                 |
        | nearest neighbour | 보조변수 > 무응답조사 단위와 가장 유사한 응답 조사단위 찾아서 대응되는 값 대체 |

   2. 다중 대치법

      - 대치, 분석, 결합 세 단계로 구성



- 결측값 처리 관련 패키지 > amelia 2, mice, mistools
- `complete.cases()` : NA값 조사해서 논리값으로 반환(bool)
- `na.omit()` : na가 있는 행 전체 삭제



---



## (4) 통계분석



**모집단과 표본**

- 모집단
  - 관찰의 대상이 되는 집단 전체
- 표본
  - 전체 모집단의 단면이 되는 가정 하에 모집단에서 선택된 모집단 구성단위의 일부



**표본추출방법**

1. 확률적 추출
   1. 단순 무작위 추출
   2. 계통추출
      - 일련번호 부여 후 첫 번째 표본을 임의로 선택, 일정 간격으로 다음 표본 선택
   3. 층하추출
      - 집단 내에서 원하는 크기의 표본을 무작위로 추출
   4. 군집추출
2. 비확률적 추출
   1. 판단추출
   2. 할당추출
   3. 편의추출



**자료의 종류**

> 척도 : 측정을 위해 부여한 숫자들 간의 관계

- 명목척도
  - 성별
- 서열척도
- 등간척도
  - 0점 존재하지 않는다(순위 부여하되 순위 간 간격 동일 > 양적 비교 가능)
  - 온도계 수치, 물가지수 등
- 비율척도
  - 절대 0점 존재 > 비율 계산 가능
  - 몸무게



**통계분석**

- 통계학 분류
  - 기술 통계학
    - 도표, 그림, 중위수, 최빈수, 평균, 표준편차 등
    - 평균, 비율, 분산, 기록, 지수
  - 추론 통계학
    - 표본 분석해서 결과 가지고 모집단 특성 밝히고 규명
    - 모집단, 표본, 포본 크기, 모수, 통계량
- 모수통계 vs 비모수통계
  - 모수통계
    - 모집단 특성이 정규분포 따르고 있을 것이라는 가정 하에 특성 추정
    - 연속성, 선형성, 특성의 정규분포성, 분산의 동질성의 조건
  - 비모수통계
    - 정규분포 가정 안 함
    - 선형성, 정규분포성 등 조건 없어도 가능
- 표본공간 : 실험에서 발생할 수 있는 모든 결과의 집합 : S or omega



```
변수(variable)

질적 변수 / 양적 변수

양적 변수 
1. 불연속변수 : 셀 수 있는 값을 가지는 변수
2. 연속변수 : 정수 사이 간격이 있는 수량 값, 한정된 숫자로 셀 수 없는 양적 변수
```



**확률기초이론**

1. 합집합
2. 교집합
3. 여집합
4. 조건부확률
5. 교집합 확률 곱의 법칙
6. 상호독립적 사상
7. 상호배타적 사상



**베이즈 정리(22년 출제예상)**

> P(E|F)를 알면 P(F|E)도 계산할 수 없나 하는 문제



**확률변수와 확률 분포**

- 확률변수
  - 원소는 정의역, 대응되는 실수값은 치역
  - 이산형 확률변수
    - 그 사건들이 속한 점들의 확률 합
    - 확률이 0보다 큰값을 갖는 점들로
  - 연속형 확률변수
    - 0보다 큰값을 갖는 함수의 면적으로 표현
    - 사건의 확률이 확률밀도함수의 면적으로 표현 > 한 점에서 확률은 0
- 확률분포
  - 치역값을 확률로 
  - 이산 확률분포 : 정수의 값을 가짐
    - 이항분포
      - 베르누이 실험에 기초
      - 몇 번 실행 > 한 가지 결과가 나오는 수 > 변수값으로 부여
    - 포아송 분포
      - 단위 시간 당(공간 당) 사건 발생 횟수에 적용되는 분포
    - 초기하분포
      - 성공 확률이 매회 일정하지 않을 경우(서로 종속사건)일 때 사용
      - 성공호가률이 매회 일정하면(서로 독립사건) > 이항분포 사용
    - 기하분포
    - 음이항분포
      - 성공확률 p인 베르누이 시행을 독립적으로 반복 시행할 때 k번 성공하기 까지 시행횟수 x의 확률분포
  - 연속 확률분포 : 소수점 값 포함하는 실수의 값 가짐
    - 정규분포
      - 모양과 위치는 분포의 평균과 표준편차로 결정
      - 평균을 중심으로 대칭적 종모양 형태
    - 표준정규분포
      - 평균과 표준편차에 따라 모양과 위치가 달라짐 > 서로 다른 두 분포의성격 비교하거나 확률 계산하려면 '표준화'가 필요
      - 표준화 : 평균이 0, 표준편차가 1이 되도록 변환
      - 표준편차 : 자료가 평균을 중심으로 얼마나 퍼져있는지
        - 만약 0에 가까우면 자료값들이 평균 근처에 집중되어 있음
    - f-분포
      - 모양은 자유도에 따라 결정됨
      - 두 모분산을 비교하는데에만 쓰이는 게 아니라, 분산분석과 회귀분석에서도 사용
      - 자유도 : 표본크기 n에서 1 뺀 값 / 우리가 자유스럽게 선택할 수 있는 값의 수
    - t-분포
      - 정규분포를 따르지만 모표준편차를 알 수도 없고 표본 크기가 30개를 넘지 못할 때 
      - 단일분포가 아니라 자유도에 따라 분포모양이 다른 여러 분포 가짐
    - 카이제곱분포
      - 자유도에 따라 분포의 모양이 변함
      - 표본크기가 클수록 정규분포에 근접하는 특성
      - 좌우대칭이 아니라 오른쪽으로 긴 꼬리
        - 제곱합의 합이라서 음수는 없는 가장 왼쪽이 0값



**표본분포**

> 모집단으로부터 n의 확률표본을 수없이 반복해서 추출한 결과로 얻는 표본통계량의 확률분포

- 표본평균을 구했을 때 모평균과 똑같을 가능성 매우 희박 > 표본분포의 이론 필요

- 중심극한정리

  - 표본이 추출되는 모집단이 정규분포를 하냐 안하냐에 따라서 영향 바음

  1. 정규분포 따를 때
     - 표본크기에 상관없이 언제나 정규분포
  2. 따르지 않을 때
     - 표본크기에 따라 모양 결정
     - 크기 작을 땐 모집단 형태에 달려있고, 클수록 분포에 상관없이 정규분포에 근접

  - 중심극한정리
    - 확률변수 x의 모집단분포가 정규분포가 아니더라도 표본크기가 30 이상이면 정규분포를 따른다는 정리



**추정과 가설검정**

> 표본을 통해서 모수 추정 >> 귀납적 추리
>
> 이 과정 > 추정, 추정치

- 추정 

  - 점추정
    - 가장 참값이라고 여겨지는 하나의 모수 값 택
    - 표본오차 때문에 모수와 일치하기 어려움
  - 구간추정
    - 모수가 특정한 구간에 잇을 것이라고
    - 신뢰구간
      - 신뢰구간 추정의 목적 : 신뢰수준은 높이고 신뢰구간은 짧게 하고
    - 신뢰수준 : (1-a) / a > 신뢰구간이 모수를 포함하지 않을 확률
    - 신뢰구간 : 일반적으로 a / 2

- 가설검정

  - 귀무가설

    - 진실할 확률이 극히 적어 버릴 것이 예상되는 가설 ' 내가 틀렸다는 주장'
    - 일어나기 힘든 일 >> 유의수준(기각역)

  - 대립가설

    - 귀무가 기각되면 채택하게 되는 가설

  - 가설검증

    1. 대립가설 설정
    2. 귀무가설 설정
    3. 귀무가설 옳다고 가정
    4. 유의수준 설정
    5. 대립가설 고려한 기각역 설정
    6. 판단
    7. 기각역 안쪽이면 귀무가설 기각 > 대립 선택

  - p < a면 귀무 기각

  - p >= a면 귀무 채택

  - 검정의 오류

    - |           | 귀무가 사실      | 귀무가 허위    |
      | --------- | ---------------- | -------------- |
      | 귀무 채택 | 신뢰수준 = 1 - a | 제 2종 오류(b) |
      | 귀무 기각 | 제 1종 오류(a)   | 검정력 = 1 - b |

      (a는 알파, b는 베타인데 그냥 편하게 씀)

    - 알파와 베타는 부의 관계, a 확률 감소시키면 b 확률 올라가고

    - a는 절대로 0값을 가질 수 없음

    - 그런데 a 위험이 더욱 심각하기 때문에 a 오류 통제하는 것이 일반적



**모수와 비모수 검정**

- 모수 

  - 관측값이 어느 특정한 확률분포(정규분포, 이항분포 등)을 따른다고 전제 후 모수에 대한 검정

- 비모수 

  - 특정한 확률분포 따른다고 할 수 없는 경우에 실시

  - (일반적으로 30개 이상이면 중심극한정리에 의해 정규분포 따른다는 전제 하에 모수 검정 적용) 

  - 30개 안되거나 정확히 하려면 정규성 검정 수행

  - | 장점                         | 단점                                   |
    | ---------------------------- | -------------------------------------- |
    | 상대적 크기로 주어질 때 유용 | 효율이 떨어짐                          |
    | 직관적으로 이해 쉬움         | 계산은 단순하지만, 단순 반복 작업 필요 |
    | 이상치에 영향 크게 안받음    |                                        |
    | 표본수 적어도 사용 가능      |                                        |

  - 비모수 검정

    - 단일 집단에서의 중위수검정
      - 부호 검정
        - +,- 표본 개수 구해서 
        - 귀무가설이 참이면 +, - 개수 동일
        - 수치 측정이 어려울 때 매우 유용
      - 윌콕슨의 부호순위 검정
        - 정보의 손실을 줄일 수 있어 검정력이 더 높음
    - 짝지은 집단의 비교 검정
      - 부호 검정
        - 처치 전후의 점수를 비교한다는 점만 다름
      - 윌콕슨 부호 순위 검정
        - 모수적 검정의 paried t-test에 해당
    - 독립된 두 집단의 비교 검정
      - 윌콕슨의 순위합 검정, 맨-휘트니 검정
        - rank sum 자료 순위 합친 순위 합 구해서 비교
      - 콜모고로프-스미르노프 검정(k-s 검정)
        - 독립된 두 집단의 누적 분포가 동일한지 알아봄
        - 동일 모집단으로부터 추출된 건지 검정
        - 정규성 여부 살펴보는데 많이 이용

  - 정규성 검정 종류

    1. q-q plot
       - 대각선 참조선 따라서 값 분포하는지 > 정규성 만족
    2. shapiro-wilk test
       - 회귀분석에서 모든 독립변수에 대해 종속변수가 정규분포 따르는지
    3. kolmogorov-simirnov test
       - 평균/표준편차와 히스토그램을 표준정규분포와 비교해서 적합도 검정
    4. anderson-darling 통계량
       - 데이터에 더 적합할수록 ad통계량이 더 적다



---



## (5) 기초 통계분석



**기술통계**

> 자료를 요약하는 기초적 통계



**회귀분석**

> 독립변수가 종속변수에 미치는 영향력 분석, 독립변수에 따라 종속변수의 변화를 예측하기 위해 사용하는 통계기법

회귀 : 세상의 많은 현상들이 평균으로 향하는 경향



**목적**

- 종속변수와 독립변수들 간 존재하는 함수관계 추정
- 독립변수들이 종속변수에 미치는 효과 검증
- 추정된 회귀함수 이용해서 종속변수 미래 값 예측



**사용하는 경우**

- 자료의 척도는 일반적으로 등간척도 or 비율척도여야
- 독립변수가 범주형 척도면 가변수(더미변수)를 만들어서 이용
  - 명목척도나 범주형 척도의 자료를 독립변수의 가변수로 변환해서 회귀분석
  - 명복변수의 범주 수에서 1개 적게 가변수 만듦
- 종속변수가 이변량 변수면 로지스틱 회귀분석



**최소제곱법**

- 개별 측정치들 간 차이(독립변수에 따라 종속변수의 변화하는 정도가 다르게 나타나는 것)
- 표본에서의 베타를 모수 베타에 가장 가깝게 추정한 회귀식을 도출하는 게 가장 이상적
- 회귀식과 측정치 간 차이인 '잔차'가 무조건 발생
- 잔차의 모든 합이 최소가 되는 회귀식을 구해야
- 직선상 위 아래(+,-)로 분포되어서 합이 0이 되니까 모두 제곱해서 합 구하기



**회귀모형에 대한 가정**

1. 선형성
   - 독립변수의 변화에 따라 종속변수도 변화하는 선형 모형
2. 독립성
   - 잔차와 독립변수와 값이 관련되어있지 않음
3. 등분산성
   - 오차항들의 분포는 동일한 분산을 가짐
   - 잔차와 예측치 산점도가 부채꼴이면 등분산성 무너지고 오차항이 이분산성 가짐
   - 분산 일정하지 않으면 가중회귀 쓰거나 종속변수 변화
4. 비상관성
   - 잔차들끼리 상관이 없어야
5. 정상성
   - 잔차항이 정규분포를 이뤄야



**체크해야 할 사항**

| 회귀모형이 통계적으로 유의미? | f통계량 확인<br />p값이 0.05보다 작으면 통계적으로 유의 |
| ----------------------------- | ------------------------------------------------------- |
| 회귀계수들이 유의미?          | t통계량과 p-값 또는 신뢰구간 확인                       |
| 모형이 얼마나 설명력?         | 결정계수 확인                                           |
| 모형이 데이터 잘 적합?        | 잔차의 그래프로 그리고 회귀진단                         |
| 데이터가 모형가정 만족시킴?   |                                                         |



**잔차** = 오차항의 관찰값 >> 잔차들을 분석해서 오차항에 대한 가정들의 성립 여부 확인 가능 > 잔차분석

- 회귀 분석 잔차분석 결과 'U'곡선 패턴 나타낼 때 해결방안은 이차항(x2)을 모형에 추가하면 됨
- 잔차들이 그래프선 상에 있으면 정상성 만족
- 잔차가 0을 기준으로 좌우 균등하면 잔차들은 등분산성 만족



**다중공선성**

- 모형의 일부 독립변수가 다른 독립변수와 상관되어 있을 때 발생 
- 분산을 증가시켜서 불안정하고 해석하기 어렵게 함
- 결정계수값은 높지만 독립변수의 유의확률이 크면 의심해봐야



**회귀분석모형의 적합도검정과 분산분석표**

- 표본에 대한 회귀선의 설명력
  - 결정계수 r2 = ssr/sst
- 분산분석
  - mse = sse / n-2
  - msr = 1 /  ssr
  - f = msr / mse
  - (표 있는데 그건 나중에)



**최적회귀방정식의 선택**

- 모든 설명변수 x들은 y의 값을 예측하는 데 참여시킴
- x 수가 많아지면 관리하는데 많은 노력이 요구되니 가능한 범위 내에서 적은 수의 설명변수 포함시켜야
- 위 두개는 서로 이율배반적이라 타협이 이뤄져야
- aic, bic는 모두 작은 값이 좋음
- 단계적 변수선택
  - 전진선택법
  - 후진제거법
  - 단계별방법
  - step() 함수 활용



**응용회귀분석**

- 능형회귀 : 특정 변수의 과다한 기여를 제한 > 상관된 다른 변수가 동시에 모형에 포함될 수 있도록

- 능형회귀(릿지)
  - L2-norm
  - 변수 선택 불가능
  - 상관관계 높은 상황에서 좋은 예측 성능
- 라쏘(lasso)
  - L1-norm
- 엘라스틱넷(elastic net)
- 람다값이 클수록 제약 많음, 변수 적음, 해석 쉬워짐 > 언더피팅
- 람다값이 작을수록 제약 적음, 변수 많음, 해석 어려워짐 > 오버피팅



---



## (6) 다변량 분석



**상관분석**

> 데이터 안 두 변수 간 관련성 파악
>
> 피어슨 상관계수, 스피어만 상관계수, 켄달의 순위상관계수



**기본 가정**

1. 선형성을 충족시켜야, 두 변수 간 정의 상관이거나 부의 상관의 형태로
2. 등분산성이 가정을 충족시켜야
3. 이상치 유무를 파악해서 제거
4. 변수는 등간 or 비율 척도로 구성되어야, 서열척도는 순위 상관 사용



**공분산**

> x증감에 따른 y의 증감에 따른 척도
>
> cov(x,y)



**피어슨 상관계수**

- 등간 비율척도일 때
- 특정 단위에 관계없는 척도 구하기 위해 공분산을 표준편차로 나누어서 표준화
- cor.test() > 유의성 검증



**스피어만 상관계수**

- 심각하게 정규분포 벗어나거나 두 변수가 순위척도 자료일 때 사용
- 두 값의 순위를 사용해서 계산(실제값 말고)
- 비선형 관계의 연관성을 파악할 수 있다는 장점
- 이산형 데이터, 순서형 데이터에 적용 가능



**상관분석 절차**

1. 산점도 그려서 두 변수의 대략적 관계
2. 상관계숭 필요한 통계량
3. 상관계수
4. 모상관계수에 대한 유의성 검정
5. 결정계수
6. 상관계수와 결정계수 제시하고 결과 설명



**다차원척도법**

> 객체들 간 거리 or 비유사성 이용해서 원래 차원보다 낮은 차원으로
>
> 관계 쉽게 파악
>
> 오차, 잡읍 포함되기도
>
> 근접정도 나타내는 측도 > 스트레스



- 계량적 다차원척도
  - 구간척도나 비율척도 자료에 근거
- 비계량적 다차원척도
  - 순서척도 자료에 근거



stress >> 0으로 작아질수록 적합된 모형이 적절하다고 판단 (cmdscale())



**주성분분석**

> 종속변수와의 거리인 잔차를 최소화
>
> 독립변수들과 주성분과의 거리인 정보손실량을 최소화하거나 분산을 최대화

서로 연관된 여러 변수의 차원을 추고하는 기법



**고유값과 고유벡터**

- 고유값
  - 방향은 보존되고 크기만 변화
- 고유벡터
  - 고유벡터의 변화되는 크기 정도



**공분산행렬**



**주성분분석 절차**

1. 데이터 특성 파악(상관관계)
2. 가중계수 추출(공분한 행렬에 대한 공값 분해 이용)
3. 차원축소(상관계수 및 상관행렬)
4. 보유 주성분 개수 판정(공헌도와 고유값 크기)



**주성분분석 문제점**

- 측정단위에 따라 분산이 크게 달라짐



scree plot : 고유값을 큰 값에서 가장 작은 값의 순서로 정렬

prcomp(scale = True) : 주성분분석함수(표준화)

bi plot : 관측치들을 첫번째와 두 번째 주성분의 좌표에 그림(화살표가 평행할수록 상관계수가 크기 때문에 큰 가중치 적용됨)







**다중공산성**

> 모형의 일부 설명변수가 다른 설명변수 간에 강한 상관관계가 나타나는 문제 
>
> 전제 가정을 위배하는 것으로 적절한 회귀분섯ㄱ을 위해 해결해야 하는 문제

진단방법

1. vif 값이 10이 넘는다
2. 결정계수 값이 크고 각 회귀계수들이 유의하지 않으면 p값이 크면 다중공선성을 의심
3. 독립변수 간 상관계수